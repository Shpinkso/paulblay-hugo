{{/* Reads data/resources/{books,videos,podcasts}/*.yaml and renders a 2-col grid.
     Works with Universal (Bootstrap 3). Uses relURL so images work with a subpath baseURL. */}}

{{ $d := site.Data.resources }}
{{ $sections := dict "Books" $d.books "Videos" $d.videos "Podcasts" $d.podcasts }}

<section class="section-content">
  <div class="container">
    {{ range $heading, $map := $sections }}
      {{ if $map }}
        {{/* Collect values from the data map */}}
        {{ $items := slice }}
        {{ range $k, $v := $map }} {{ $items = $items | append $v }} {{ end }}

        {{/* Normalise weights and sort by weight then title */}}
        {{ $norm := slice }}
        {{ range $items }}
          {{ $w := 1000 }}{{ with .weight }}{{ $w = int (printf "%v" .) }}{{ end }}
          {{ $norm = $norm | append (dict
            "title" .title
            "image" .image
            "url" .url
            "description" .description
            "weight" $w
          ) }}
        {{ end }}
        {{ $norm = sort $norm "weight" "title" }}

        <div class="resource-section" style="margin-bottom:40px">
          <h2 class="h3 text-center text-uppercase" style="margin-bottom:20px">{{ $heading }}</h2>
          <div class="row">
            {{ range $norm }}
              <div class="col-sm-6">
                <div class="panel panel-default" style="border:none; box-shadow:none;">
                  <div class="panel-body text-center">
                    <a href="{{ .url }}" class="text-decoration-none" target="_blank" rel="noopener">
                      <img src="{{ .image | relURL }}" alt="{{ .title }}"
                           class="img-responsive center-block"
                           style="max-height:200px; object-fit:cover; border-radius:6px; margin-bottom:15px;">
                      <h3 class="h4" style="margin-top:0">{{ .title }}</h3>
                      <p class="text-muted" style="margin-bottom:0">{{ .description }}</p>
                    </a>
                  </div>
                </div>
              </div>
            {{ end }}
          </div>
        </div>
      {{ end }}
    {{ end }}
  </div>
</section>
